<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recipe for a Good Relationship</title>

  <style>
    :root{
      /* Background */
      --stripe1:#FFF3B0;
      --stripe2:#FFE89A;

      /* Palette */
      --pink:#FF73B8;
      --pink2:#FF99CD;
      --purple:#A88BFF;
      --blue:#78C8FF;
      --mint:#8FF2C8;
      --peach:#FFB38A;
      --ink:#4B3B2D;

      --panel: rgba(255,255,255,0.78);
      --shadow: 0 18px 34px rgba(0,0,0,0.12);
      --shadowSoft: 0 12px 0 rgba(0,0,0,0.06);

      /* Face crop (hard-code here; use Crop Tuner if needed) */
      --pri-x: 34%;
      --pri-y: 58%;
      --ash-x: 72%;
      --ash-y: 60%;

      /* Batter fill px */
      --fillPx: 0px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background: repeating-linear-gradient(
        90deg,
        var(--stripe1) 0px,
        var(--stripe1) 30px,
        var(--stripe2) 30px,
        var(--stripe2) 60px
      );
    }

    .wrap{
      width:min(1120px, 100%);
      margin:0 auto;
      padding: 16px 14px 16px;
      height: 100%;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    /* ===== Start overlay ===== */
    .startOverlay{
      position:fixed; inset:0; z-index:200;
      display:grid; place-items:center;
      background: rgba(255,255,255,0.58);
      backdrop-filter: blur(4px);
      padding: 18px;
    }
    .startCard{
      width:min(760px, 100%);
      border-radius: 28px;
      border: 5px solid #fff;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 22px 60px rgba(0,0,0,0.18);
      padding: 18px;
      text-align:center;
      animation: popIn 520ms cubic-bezier(.2,.9,.2,1) both;
    }
    @keyframes popIn{
      from{ transform: scale(0.86) translateY(10px); opacity:0; }
      to{ transform: scale(1) translateY(0); opacity:1; }
    }
    .startTitle{
      font-weight: 900;
      font-size: clamp(28px, 4.6vw, 48px);
      color: var(--pink);
      -webkit-text-stroke: 10px rgba(255,255,255,0.95);
      paint-order: stroke fill;
      text-shadow: 0 16px 24px rgba(0,0,0,0.06);
      margin: 6px 0 8px;
      line-height:1.05;
    }
    .startText{
      margin: 0 0 12px;
      color: rgba(75,59,45,0.72);
      font-size: 14px;
      line-height:1.5;
    }
    .btn{
      appearance:none;
      border: 3px solid #fff;
      background: linear-gradient(180deg, #FF99CD, #FF73B8);
      color: #fff;
      font-weight: 900;
      border-radius: 999px;
      padding: 10px 18px;
      cursor:pointer;
      box-shadow: 0 14px 0 rgba(0,0,0,0.08);
      transition: transform 120ms ease;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0) scale(0.99); }

    /* ===== Header ===== */
    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .titleWrap{ text-align:center; flex:1; }
    .title{
      display:inline-block;
      font-weight: 900;
      font-size: clamp(36px, 5.2vw, 72px);
      letter-spacing:-0.02em;
      color: var(--pink);
      -webkit-text-stroke: 11px rgba(255,255,255,0.95);
      paint-order: stroke fill;
      text-shadow:
        0 10px 0 rgba(255,255,255,0.62),
        0 18px 24px rgba(0,0,0,0.08);
      padding: 6px 16px 8px;
    }
    .sparkles{
      margin-top: 2px;
      font-size: 16px;
      color: rgba(75,59,45,0.55);
    }
    .controls{
      display:flex;
      align-items:center;
      gap: 10px;
      margin-top: 6px;
    }
    .pill{
      font-weight: 900;
      color: rgba(75,59,45,0.78);
      background: rgba(255,255,255,0.9);
      border: 3px solid #fff;
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: var(--shadowSoft);
      white-space:nowrap;
    }
    .resetBtn{
      appearance:none;
      border: 3px solid #fff;
      background: linear-gradient(180deg, #BFE7FF, #78C8FF);
      color: #fff;
      font-weight: 900;
      border-radius: 999px;
      padding: 10px 14px;
      cursor:pointer;
      box-shadow: 0 14px 0 rgba(0,0,0,0.08);
      transition: transform 120ms ease;
      white-space:nowrap;
    }
    .resetBtn:hover{ transform: translateY(-1px); }
    .resetBtn:active{ transform: translateY(0) scale(0.99); }

    /* ===== Board ===== */
    .board{
      flex:1;
      background: var(--panel);
      border: 5px solid #fff;
      border-radius: 28px;
      box-shadow: var(--shadow);
      padding: 12px;
      position:relative;
      overflow:hidden;
    }

    /* Decorative floaties */
    .floaty{ position:absolute; inset:0; pointer-events:none; opacity:0.62; z-index:1; }
    .floaty span{
      position:absolute; font-size:18px;
      filter: drop-shadow(0 4px 0 rgba(255,255,255,0.7));
      animation: drift 5.6s ease-in-out infinite;
    }
    @keyframes drift{
      0%,100%{ transform: translateY(0) rotate(0deg); opacity:0.55; }
      50%{ transform: translateY(-11px) rotate(7deg); opacity:0.9; }
    }

    /* Speech bubbles */
    .speech{
      position:absolute; top: 14px; z-index: 5;
      max-width: 270px;
      padding: 14px 14px 12px;
      border-radius: 22px;
      border: 4px solid #fff;
      box-shadow: var(--shadowSoft);
      line-height:1.2;
      font-weight: 800;
    }
    .speech small{
      display:block; margin-top:6px;
      color: rgba(75,59,45,0.65);
      font-size:12px; font-weight:800;
    }
    .speech.left{ left: 18px; background:#FFE9F5; }
    .speech.right{ right: 18px; background:#E9F7FF; }
    .speech:after{
      content:"";
      position:absolute;
      width: 18px; height: 18px;
      bottom: -11px; left: 44px;
      background: inherit;
      border-left: 4px solid #fff;
      border-bottom: 4px solid #fff;
      transform: rotate(45deg);
    }
    .speech.right:after{ left:auto; right:44px; }

    /* ===== Center zone ===== */
    .centerZone{
      position:absolute;
      left:0; right:0;
      bottom: 192px; /* reserve for ingredient row */
      display:flex;
      justify-content:center;
      padding: 0 12px;
      z-index: 10;
    }
    .bowlWrap{ width:min(860px, 100%); position:relative; }

    .card{
      border-radius: 26px;
      border: 5px solid #fff;
      background: rgba(255,255,255,0.80);
      box-shadow: var(--shadow);
      padding: 12px;
    }

    .bowlHeader{
      display:flex; justify-content:space-between; align-items:flex-end;
      gap: 10px; margin-bottom: 8px;
    }
    .bowlTitle{ font-weight: 900; font-size: 22px; color: rgba(75,59,45,0.85); }
    .bowlHint{ margin: 4px 0 0; font-size: 13px; color: rgba(75,59,45,0.65); font-weight: 800; }

    /* ===== Drop zone (strict) ===== */
    .dropZone{
      height: 210px;
      border-radius: 30px;
      border: 5px dashed rgba(168,139,255,0.58);
      background: radial-gradient(circle at 50% 30%, rgba(255,255,255,0.95), rgba(255,255,255,0.35));
      display:grid;
      place-items:center;
      position:relative;
      transition: transform 180ms ease, border-color 180ms ease, box-shadow 180ms ease;
      overflow:hidden;
      z-index: 10;
    }
    .dropZone.active{
      border-color: rgba(120,200,255,0.95);
      box-shadow: 0 0 0 12px rgba(120,200,255,0.16) inset;
      transform: scale(1.01);
    }

    /* Batter fill */
    .batter{
      position:absolute;
      left: 16%;
      right: 16%;
      bottom: 20px;
      height: var(--fillPx);
      max-height: 110px;
      border-radius: 999px 999px 28px 28px;
      background: linear-gradient(180deg, rgba(255,153,205,0.30), rgba(255,115,184,0.40));
      border: 3px solid rgba(255,255,255,0.92);
      box-shadow: 0 10px 0 rgba(0,0,0,0.05);
      transition: height 420ms cubic-bezier(.2,.9,.2,1);
      z-index: 2;
      overflow:hidden;
    }

    /* Sparkles on drop */
    .sparkBurst{ position:absolute; inset:0; pointer-events:none; z-index: 30; }
    .spark{
      position:absolute;
      font-size: 18px;
      animation: sparkle 650ms cubic-bezier(.2,.9,.2,1) forwards;
      filter: drop-shadow(0 4px 0 rgba(255,255,255,0.85));
    }
    @keyframes sparkle{
      0%{ transform: translate(0,0) scale(0.7); opacity:0; }
      15%{ opacity:1; }
      100%{ transform: translate(var(--dx), var(--dy)) scale(1.2); opacity:0; }
    }

    /* Bowl SVG */
    .bowlSvg{
      width:min(660px, 94%);
      height:auto;
      filter: drop-shadow(0 14px 0 rgba(0,0,0,0.06));
      pointer-events:none;
      z-index: 5;
    }

    .dropText{
      position:absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 13px;
      color: rgba(75,59,45,0.65);
      background: rgba(255,255,255,0.86);
      border: 3px solid #fff;
      border-radius: 999px;
      padding: 7px 10px;
      box-shadow: var(--shadowSoft);
      white-space:nowrap;
      z-index: 40;
      font-weight: 900;
    }

    /* ===== Characters built ‚Äúlike the mock‚Äù: behind bowl, hands on rim, photo sticker heads ===== */
    .characterLayer{
      position:absolute;
      inset: 0;
      pointer-events:none;
      z-index: 20; /* ABOVE bowl svg, but still inside drop zone */
    }

    .chef{
      position:absolute;
      bottom: 18px;
      width: 260px;
      height: 260px;
    }
    .chef.left{ left: 18px; }
    .chef.right{ right: 18px; }

    /* Sticker head (photo) */
    .headSticker{
      position:absolute;
      top: 0px;
      left: 50%;
      transform: translateX(-50%);
      width: 132px;
      height: 132px;
      z-index: 25;
      filter: drop-shadow(0 18px 0 rgba(0,0,0,0.08));
    }
    .headSticker::before{
      content:"";
      position:absolute;
      inset:-10px;
      background:#fff;
      clip-path: polygon(
        50% 0%, 62% 4%, 72% 10%, 80% 18%, 86% 30%,
        90% 44%, 90% 56%, 86% 70%, 78% 84%,
        64% 92%, 50% 95%, 36% 92%, 22% 84%,
        14% 70%, 10% 56%, 10% 44%, 14% 30%,
        20% 18%, 28% 10%, 38% 4%
      );
      border-radius: 24px;
    }
    .headSticker .inner{
      position:absolute;
      inset: 0;
      clip-path: polygon(
        50% 1%, 62% 5%, 72% 11%, 80% 19%, 85% 30%,
        89% 44%, 89% 56%, 85% 70%, 78% 84%,
        64% 92%, 50% 94%, 36% 92%, 22% 84%,
        15% 70%, 11% 56%, 11% 44%, 15% 30%,
        20% 19%, 28% 11%, 38% 5%
      );
      border-radius: 22px;
      overflow:hidden;
      background: rgba(255,255,255,0.65);
    }
    .headSticker img{
      width:100%;
      height:100%;
      object-fit:cover;
      transform: scale(1.14);
      display:block;
    }
    .chef.left .headSticker img{ object-position: var(--pri-x) var(--pri-y); }
    .chef.right .headSticker img{ object-position: var(--ash-x) var(--ash-y); }

    /* Body behind bowl */
    .torso{
      position:absolute;
      top: 102px;
      left: 50%;
      transform: translateX(-50%);
      width: 210px;
      height: 150px;
      border-radius: 32px;
      border: 5px solid #fff;
      box-shadow: var(--shadowSoft);
      background: rgba(255,255,255,0.82);
      z-index: 22;
    }
    .apron{
      position:absolute;
      left: 50%;
      top: 112px;
      transform: translateX(-50%);
      width: 220px;
      height: 160px;
      border-radius: 32px 32px 38px 38px;
      border: 5px solid #fff;
      box-shadow: var(--shadowSoft);
      z-index: 23;
    }
    .chef.left .apron{ background: linear-gradient(180deg, #FFB4D8, #FF8BC6); }
    .chef.right .apron{ background: linear-gradient(180deg, #BFE7FF, #83CCFF); }

    /* Hands placed on bowl rim (inside drop zone) */
    .hand{
      position:absolute;
      width: 64px;
      height: 36px;
      border-radius: 999px;
      background: #FFE2CF;
      border: 5px solid #fff;
      box-shadow: 0 10px 0 rgba(0,0,0,0.05);
      z-index: 35; /* above bowl rim for ‚Äúholding the bowl‚Äù look */
      top: 152px;
    }
    .chef.left .hand.h1{ left: 78px; transform: rotate(-12deg); }
    .chef.left .hand.h2{ left: 138px; transform: rotate(10deg); }
    .chef.right .hand.h1{ right: 138px; transform: rotate(-10deg); }
    .chef.right .hand.h2{ right: 78px; transform: rotate(12deg); }

    /* Props (like mock) */
    .prop{
      position:absolute;
      top: 120px;
      font-size: 30px;
      filter: drop-shadow(0 8px 0 rgba(0,0,0,0.08));
      z-index: 26;
      animation: wiggle 2.4s ease-in-out infinite;
    }
    @keyframes wiggle{
      0%,100%{ transform: rotate(0deg) translateY(0); }
      50%{ transform: rotate(6deg) translateY(-3px); }
    }
    .chef.left .prop{ left: 14px; }
    .chef.right .prop{ right: 14px; }

    /* Reaction pop */
    .chef.react{ animation: chefPop 260ms cubic-bezier(.2,.9,.2,1) both; }
    @keyframes chefPop{
      from{ transform: translateY(0) scale(1); }
      50%{ transform: translateY(-2px) scale(1.02); }
      to{ transform: translateY(0) scale(1); }
    }

    /* Chips */
    .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; min-height: 40px; }
    .chip{
      font-size: 12px; font-weight: 900;
      padding: 7px 10px;
      border-radius: 999px;
      border: 3px solid #fff;
      background: rgba(255,255,255,0.92);
      box-shadow: var(--shadowSoft);
    }

    /* ===== Cake card ===== */
    .cakeCard{ margin-top:10px; display:none; overflow:hidden; }
    .cakeCard.show{ display:block; }
    .cakeRise{ animation: riseIn 760ms cubic-bezier(.2,.9,.2,1) both; }
    @keyframes riseIn{
      from{ transform: translateY(36px) scale(0.98); opacity:0; }
      to{ transform: translateY(0) scale(1); opacity:1; }
    }
    .cakePrompt{
      margin: 0 0 10px;
      font-size: 14px;
      color: rgba(75,59,45,0.72);
      text-align:center;
      font-weight: 900;
    }

    .cakeBtn{
      margin: 0 auto;
      display:grid;
      place-items:center;
      width: min(520px, 96%);
      aspect-ratio: 4 / 3;
      border-radius: 28px;
      border: 5px solid #fff;
      background: radial-gradient(circle at 50% 25%, rgba(255,255,255,0.95), rgba(255,255,255,0.55));
      box-shadow: var(--shadow);
      cursor:pointer;
      transition: transform 140ms ease;
      position:relative;
      overflow:visible; /* allow text to pop OUT */
    }
    .cakeBtn:hover{ transform: scale(1.01); }
    .cakeBtn:active{ transform: scale(0.99); }

    .cakeSvg{
      width: min(360px, 86%);
      height:auto;
      filter: drop-shadow(0 14px 0 rgba(0,0,0,0.06));
      pointer-events:none;
      z-index: 2;
    }

    /* >>> POP-OUT MESSAGE IN FRONT OF CAKE <<< */
    .popMessage{
      position:absolute;
      left: 50%;
      top: 18%;
      transform: translateX(-50%) scale(0.86);
      width: 92%;
      text-align:center;
      font-weight: 900;
      font-size: clamp(22px, 3.0vw, 38px);
      color: var(--pink);
      -webkit-text-stroke: 10px rgba(255,255,255,0.98);
      paint-order: stroke fill;
      text-shadow:
        0 18px 30px rgba(0,0,0,0.14),
        0 10px 0 rgba(255,255,255,0.70);
      line-height:1.05;
      opacity:0;
      z-index: 999; /* guaranteed in front */
      pointer-events:none;
      filter: drop-shadow(0 14px 0 rgba(0,0,0,0.08));
    }
    .popMessage.show{
      animation: popOut 780ms cubic-bezier(.2,.95,.2,1) both;
    }
    @keyframes popOut{
      0%{ opacity:0; transform: translateX(-50%) translateY(18px) scale(0.72); }
      45%{ opacity:1; transform: translateX(-50%) translateY(-10px) scale(1.10); }
      100%{ opacity:1; transform: translateX(-50%) translateY(-2px) scale(1.00); }
    }

    /* Crumbs */
    .crumbLayer{ position:absolute; inset:0; pointer-events:none; z-index: 120; }
    .crumb{
      position:absolute;
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: var(--c);
      animation: crumbFly 720ms cubic-bezier(.2,.9,.2,1) forwards;
      box-shadow: 0 6px 0 rgba(0,0,0,0.05);
    }
    @keyframes crumbFly{
      0%{ transform: translate(0,0) scale(0.9); opacity:0; }
      10%{ opacity:1; }
      100%{ transform: translate(var(--dx), var(--dy)) rotate(var(--r)) scale(1.0); opacity:0; }
    }

    /* ===== Ingredients row ===== */
    .ingredientsPanel{
      position:absolute;
      left: 12px; right: 12px;
      bottom: 12px;
      border-radius: 26px;
      border: 5px solid #fff;
      background: rgba(255,255,255,0.80);
      box-shadow: var(--shadow);
      padding: 10px;
      z-index: 50;
    }
    .ingredientsGrid{
      display:grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap: 10px;
    }
    .ingredient{
      border-radius: 18px;
      border: 5px solid #fff;
      background: rgba(255,255,255,0.92);
      box-shadow: var(--shadowSoft);
      padding: 8px 8px 7px;
      cursor: grab;
      user-select:none;
      transition: transform 120ms ease, filter 120ms ease;
      min-height: 138px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      position:relative;
    }
    .ingredient:hover{ transform: translateY(-2px) rotate(-0.6deg); filter: brightness(1.02); }
    .ingredient:active{ cursor:grabbing; transform: translateY(0) scale(0.99); }
    .ingredient.used{ opacity:0.45; cursor:not-allowed; filter: grayscale(0.45); }
    .ingCaption{
      font-weight: 900;
      font-size: 14px;
      text-align:center;
      color: rgba(75,59,45,0.86);
      text-shadow: 0 2px 0 rgba(255,255,255,0.7);
      margin-bottom: 4px;
    }
    .ingArt{ height: 78px; display:grid; place-items:center; }
    .ingArt svg{ width: 82px; height: 82px; filter: drop-shadow(0 10px 0 rgba(0,0,0,0.06)); }
    .ingFood{ text-align:center; font-size: 12px; color: rgba(75,59,45,0.62); margin-top: 4px; font-weight: 800; }

    /* Confetti canvas */
    #confetti{
      position:fixed; inset:0; pointer-events:none;
      z-index: 500;
      display:none;
    }
    #confetti.show{ display:block; }

    /* Mobile fallback */
    @media (max-width: 620px){
      body{ overflow:auto; }
      .ingredientsGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .chef{ width: 220px; height: 240px; }
      .chef.left{ left: 6px; }
      .chef.right{ right: 6px; }
      .dropZone{ height: 240px; }
    }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>

  <div class="startOverlay" id="startOverlay">
    <div class="startCard">
      <div class="startTitle">Click to begin</div>
      <p class="startText">Drag each ingredient into the mixing bowl.<br>On mobile, you can tap ingredients too.</p>
      <button class="btn" id="startBtn" type="button">Start</button>
    </div>
  </div>

  <div class="wrap">
    <div class="top">
      <div class="titleWrap">
        <div class="title">Recipe for a Good Relationship</div>
        <div class="sparkles">‚òÖ ‚ú¶ ‚ú® ‚òÖ ‚ú¶ ‚ú® ‚òÖ ‚ú¶</div>
      </div>
      <div class="controls">
        <div class="pill" id="progressPill">0 / 6</div>
        <button class="resetBtn" id="resetBtn" type="button">Reset</button>
      </div>
    </div>

    <section class="board">
      <div class="floaty" aria-hidden="true">
        <span style="left:5%; top:22%;">‚ú®</span>
        <span style="left:10%; top:40%;">üíñ</span>
        <span style="left:18%; top:26%;">‚≠ê</span>
        <span style="left:28%; top:18%;">‚ú®</span>
        <span style="left:36%; top:34%;">üíô</span>
        <span style="left:48%; top:20%;">‚≠ê</span>
        <span style="left:56%; top:30%;">‚ú®</span>
        <span style="left:66%; top:22%;">üíñ</span>
        <span style="left:74%; top:36%;">‚≠ê</span>
        <span style="left:82%; top:20%;">‚ú®</span>
        <span style="left:90%; top:34%;">üíô</span>
      </div>

      <div class="speech left">
        üíó We‚Äôre making this properly
        <small>Drag the ingredients in.</small>
      </div>
      <div class="speech right">
        One step at a time‚Ä¶
        <small>Then we bake the cake.</small>
      </div>

      <div class="centerZone">
        <div class="bowlWrap">
          <div class="card">
            <div class="bowlHeader">
              <div>
                <div class="bowlTitle">Mixing Bowl</div>
                <p class="bowlHint" id="bowlHint">Drop all ingredients into the bowl.</p>
              </div>
              <div class="pill" id="progressInline">0 / 6</div>
            </div>

            <div class="dropZone" id="bowl">
              <!-- Characters INSIDE the bowl zone, behind the rim -->
              <div class="characterLayer" aria-hidden="true">
                <div class="chef left" id="priChef">
                  <div class="headSticker">
                    <div class="inner"><img src="./couple.jpg" alt="Pri head"></div>
                  </div>
                  <div class="torso"></div>
                  <div class="apron"></div>
                  <div class="prop">ü•Ñ</div>
                  <div class="hand h1"></div>
                  <div class="hand h2"></div>
                </div>

                <div class="chef right" id="ashChef">
                  <div class="headSticker">
                    <div class="inner"><img src="./couple.jpg" alt="Ash head"></div>
                  </div>
                  <div class="torso"></div>
                  <div class="apron"></div>
                  <div class="prop">üç≥</div>
                  <div class="hand h1"></div>
                  <div class="hand h2"></div>
                </div>
              </div>

              <div class="batter" id="batter"></div>
              <div class="sparkBurst" id="sparkBurst"></div>

              <svg class="bowlSvg" viewBox="0 0 800 260" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <defs>
                  <linearGradient id="bowlG" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0" stop-color="#FFD1EB"/>
                    <stop offset="1" stop-color="#FF9FD2"/>
                  </linearGradient>
                </defs>
                <path d="M110 90 C160 30, 640 30, 690 90
                         C740 150, 660 240, 400 240
                         C140 240, 60 150, 110 90 Z"
                      fill="url(#bowlG)" stroke="#FFFFFF" stroke-width="12" />
                <path d="M175 105 C215 70, 585 70, 625 105
                         C660 145, 600 205, 400 205
                         C200 205, 140 145, 175 105 Z"
                      fill="rgba(255,255,255,0.35)" />
              </svg>

              <div class="dropText" id="dropText">Drop ingredients here</div>
            </div>

            <div class="chips" id="chips"></div>

            <div class="card cakeCard" id="cakeCard" style="margin-top:10px;">
              <div class="cakeRise" id="cakeRise">
                <p class="cakePrompt">Cake is ready. Click it.</p>
                <div class="cakeBtn" id="cakeBtn" tabindex="0">
                  <div class="crumbLayer" id="crumbLayer"></div>

                  <!-- POP-OUT message (IN FRONT of cake) -->
                  <div class="popMessage" id="popMessage">I‚Äôm sorry.<br>I love you</div>

                  <svg class="cakeSvg" viewBox="0 0 560 420" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <defs>
                      <linearGradient id="cakeBase" x1="0" x2="0" y1="0" y2="1">
                        <stop offset="0" stop-color="#FFFFFF"/>
                        <stop offset="1" stop-color="#F6F0E6"/>
                      </linearGradient>
                      <linearGradient id="icing" x1="0" x2="0" y1="0" y2="1">
                        <stop offset="0" stop-color="#FFD1EB"/>
                        <stop offset="1" stop-color="#FF9FD2"/>
                      </linearGradient>
                    </defs>
                    <ellipse cx="280" cy="365" rx="210" ry="42" fill="#E9F7FF" stroke="#FFFFFF" stroke-width="10"/>
                    <rect x="120" y="250" width="320" height="95" rx="28" fill="url(#cakeBase)" stroke="#FFFFFF" stroke-width="10"/>
                    <rect x="160" y="175" width="240" height="78" rx="26" fill="url(#cakeBase)" stroke="#FFFFFF" stroke-width="10"/>
                    <rect x="200" y="115" width="160" height="62" rx="24" fill="url(#cakeBase)" stroke="#FFFFFF" stroke-width="10"/>
                    <path d="M205 120 H355
                             C355 120, 360 140, 345 145
                             C330 150, 340 166, 320 165
                             C300 164, 310 180, 290 177
                             C270 174, 276 190, 255 186
                             C230 182, 240 162, 220 160
                             C200 158, 205 140, 205 140 Z"
                          fill="url(#icing)" stroke="#FFFFFF" stroke-width="8" />
                    <rect x="268" y="70" width="24" height="52" rx="12" fill="#BFE7FF" stroke="#FFFFFF" stroke-width="8"/>
                    <ellipse cx="280" cy="62" rx="14" ry="18" fill="#FFD67A" stroke="#FFFFFF" stroke-width="8"/>
                  </svg>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div class="ingredientsPanel">
        <div class="ingredientsGrid" id="ingredients"></div>
      </div>
    </section>
  </div>

  <script>
    /* ===== audio pop ===== */
    const SFX_ENABLED = true;
    let audioCtx = null;
    function popSound() {
      if (!SFX_ENABLED) return;
      try {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const t0 = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = "triangle";
        osc.frequency.setValueAtTime(520, t0);
        osc.frequency.exponentialRampToValueAtTime(260, t0 + 0.08);
        gain.gain.setValueAtTime(0.0001, t0);
        gain.gain.exponentialRampToValueAtTime(0.22, t0 + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.10);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(t0);
        osc.stop(t0 + 0.12);
      } catch {}
    }

    const INGREDIENTS = [
      { id:"salt",   caption:"Respect",          food:"Sea Salt",     art: artSalt() },
      { id:"lemon",  caption:"Communication",    food:"Lemon Zest",   art: artLemon() },
      { id:"milk",   caption:"Trust",            food:"Milk",         art: artMilk() },
      { id:"honey",  caption:"Honesty",          food:"Honey",        art: artHoney() },
      { id:"time",   caption:"Pri and Ash time", food:"Strawberries", art: artStrawberries() },
      { id:"butter", caption:"Support",          food:"Butter",       art: artButter() },
    ];

    const startOverlay = document.getElementById("startOverlay");
    const startBtn = document.getElementById("startBtn");

    const priChef = document.getElementById("priChef");
    const ashChef = document.getElementById("ashChef");

    const ingredientsEl = document.getElementById("ingredients");
    const bowlEl = document.getElementById("bowl");
    const sparkBurstEl = document.getElementById("sparkBurst");
    const chipsEl = document.getElementById("chips");

    const progressPill = document.getElementById("progressPill");
    const progressInline = document.getElementById("progressInline");
    const bowlHint = document.getElementById("bowlHint");
    const dropText = document.getElementById("dropText");
    const resetBtn = document.getElementById("resetBtn");

    const cakeCard = document.getElementById("cakeCard");
    const cakeRise = document.getElementById("cakeRise");
    const cakeBtn = document.getElementById("cakeBtn");
    const popMessage = document.getElementById("popMessage");
    const crumbLayer = document.getElementById("crumbLayer");

    const confettiCanvas = document.getElementById("confetti");
    const ctx = confettiCanvas.getContext("2d");

    let mixed = new Set();
    let cakeReady = false;
    let exploded = false;

    function startGame(){
      startOverlay.style.display = "none";
      popSound(); // unlock audio
    }
    startBtn.addEventListener("click", (e)=>{ e.stopPropagation(); startGame(); });
    startOverlay.addEventListener("click", (e)=>{ if(e.target===startOverlay) startGame(); });

    resetBtn.addEventListener("click", resetGame);

    function resetGame(){
      mixed = new Set();
      cakeReady = false;
      exploded = false;

      cakeCard.classList.remove("show");
      popMessage.classList.remove("show");
      crumbLayer.innerHTML = "";

      document.documentElement.style.setProperty("--fillPx","0px");

      bowlHint.textContent = "Drop all ingredients into the bowl.";
      dropText.textContent = "Drop ingredients here";

      renderIngredients();
      updateUI();
    }

    function renderIngredients(){
      ingredientsEl.innerHTML = "";
      for (const ing of INGREDIENTS){
        const card = document.createElement("div");
        card.className = "ingredient";
        card.draggable = true;
        card.dataset.id = ing.id;

        card.innerHTML = `
          <div class="ingCaption">${escapeHtml(ing.caption)}</div>
          <div class="ingArt">${ing.art}</div>
          <div class="ingFood">${escapeHtml(ing.food)}</div>
        `;

        card.addEventListener("dragstart", (e)=>{
          if (cakeReady || mixed.has(ing.id)){ e.preventDefault(); return; }
          e.dataTransfer.setData("text/plain", ing.id);
          e.dataTransfer.effectAllowed = "move";
        });

        card.addEventListener("click", ()=>{
          if (cakeReady || mixed.has(ing.id)) return;
          addIngredient(ing.id);
          bounceBowl();
        });

        ingredientsEl.appendChild(card);
      }
      syncUsedState();
    }

    bowlEl.addEventListener("dragover", (e)=>{
      e.preventDefault();
      if (cakeReady) return;
      bowlEl.classList.add("active");
    });
    bowlEl.addEventListener("dragleave", ()=> bowlEl.classList.remove("active"));
    bowlEl.addEventListener("drop", (e)=>{
      e.preventDefault();
      bowlEl.classList.remove("active");
      if (cakeReady) return;
      const id = e.dataTransfer.getData("text/plain");
      addIngredient(id);
      bounceBowl();
    });

    function bounceBowl(){
      bowlEl.style.transform = "scale(1.01)";
      setTimeout(()=> bowlEl.style.transform="", 140);
    }

    function addIngredient(id){
      if (!id || cakeReady || mixed.has(id)) return;
      if (!INGREDIENTS.some(x=>x.id===id)) return;

      mixed.add(id);
      popSound();
      sparklesInBowl();
      characterReact();
      updateFill();
      updateUI();

      if (mixed.size === INGREDIENTS.length) bakeCake();
    }

    function updateUI(){
      const txt = `${mixed.size} / ${INGREDIENTS.length}`;
      progressPill.textContent = txt;
      progressInline.textContent = txt;

      chipsEl.innerHTML = "";
      for (const id of mixed){
        const ing = INGREDIENTS.find(x=>x.id===id);
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.textContent = ing.caption;
        chipsEl.appendChild(chip);
      }
      syncUsedState();

      if (!cakeReady){
        bowlHint.textContent = mixed.size===0 ? "Drop all ingredients into the bowl." : "Nice. Keep going.";
      }
    }

    function syncUsedState(){
      document.querySelectorAll(".ingredient").forEach(el=>{
        const id = el.dataset.id;
        if (cakeReady || mixed.has(id)){
          el.classList.add("used");
          el.draggable = false;
        } else {
          el.classList.remove("used");
          el.draggable = true;
        }
      });
    }

    function updateFill(){
      const maxPx = 110;
      const px = Math.round((mixed.size / INGREDIENTS.length) * maxPx);
      document.documentElement.style.setProperty("--fillPx", `${px}px`);
    }

    function characterReact(){
      priChef.classList.remove("react");
      ashChef.classList.remove("react");
      const who = (mixed.size % 2 === 0) ? priChef : ashChef;
      who.classList.add("react");
      setTimeout(()=> who.classList.remove("react"), 280);
    }

    function bakeCake(){
      cakeReady = true;
      bowlHint.textContent = "All mixed. Cake time!";
      dropText.textContent = "Cake is ready!";

      cakeCard.classList.add("show");

      cakeRise.classList.remove("cakeRise");
      void cakeRise.offsetWidth;
      cakeRise.classList.add("cakeRise");

      popSound();
    }

    function finale(){
      if (!cakeReady || exploded) return;
      exploded = true;

      // Pop message IN FRONT of cake
      popMessage.classList.add("show");

      // Confetti (single burst)
      startConfettiBurst(1200);

      // Crumbs explosion
      crumbExplosion();

      cakeBtn.animate(
        [
          { transform:"scale(1)" },
          { transform:"scale(1.06)" },
          { transform:"scale(0.94)" },
          { transform:"scale(1)" }
        ],
        { duration: 520, easing:"cubic-bezier(.2,.9,.2,1)" }
      );

      popSound();
    }

    cakeBtn.addEventListener("click", finale);
    cakeBtn.addEventListener("keydown", (e)=>{
      if (e.key==="Enter" || e.key===" "){ e.preventDefault(); finale(); }
    });

    function sparklesInBowl(){
      const symbols = ["‚ú®","‚≠ê","üíñ","‚ú¶"];
      const rect = bowlEl.getBoundingClientRect();
      const cx = rect.width * 0.5;
      const cy = rect.height * 0.42;

      for (let i=0;i<12;i++){
        const s = document.createElement("div");
        s.className = "spark";
        s.textContent = symbols[Math.floor(Math.random()*symbols.length)];
        const dx = (Math.random()*2-1) * (55 + Math.random()*45);
        const dy = (Math.random()*2-1) * (28 + Math.random()*34);
        s.style.left = (cx + (Math.random()*2-1)*12) + "px";
        s.style.top  = (cy + (Math.random()*2-1)*12) + "px";
        s.style.setProperty("--dx", dx + "px");
        s.style.setProperty("--dy", dy + "px");
        sparkBurstEl.appendChild(s);
        setTimeout(()=> s.remove(), 720);
      }
    }

    function crumbExplosion(){
      crumbLayer.innerHTML = "";
      const colors = ["#FF73B8","#FF99CD","#A88BFF","#78C8FF","#8FF2C8","#FFD67A","#FFB38A","#FFFFFF"];
      const rect = cakeBtn.getBoundingClientRect();
      const cx = rect.width * 0.5;
      const cy = rect.height * 0.48;

      const count = 34;
      for (let i=0;i<count;i++){
        const c = document.createElement("div");
        c.className = "crumb";
        c.style.left = cx + "px";
        c.style.top = cy + "px";
        c.style.setProperty("--c", colors[Math.floor(Math.random()*colors.length)]);
        c.style.setProperty("--dx", ((Math.random()*2-1) * (90 + Math.random()*80)) + "px");
        c.style.setProperty("--dy", ((Math.random()*2-1) * (70 + Math.random()*70)) + "px");
        c.style.setProperty("--r", ((Math.random()*2-1) * 260) + "deg");
        crumbLayer.appendChild(c);
        setTimeout(()=> c.remove(), 760);
      }
    }

    function resizeCanvas(){
      confettiCanvas.width = window.innerWidth * devicePixelRatio;
      confettiCanvas.height = window.innerHeight * devicePixelRatio;
      confettiCanvas.style.width = window.innerWidth + "px";
      confettiCanvas.style.height = window.innerHeight + "px";
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    window.addEventListener("resize", resizeCanvas);

    function startConfettiBurst(durationMs){
      resizeCanvas();
      confettiCanvas.classList.add("show");

      const colors = ["#FF73B8","#FF99CD","#A88BFF","#78C8FF","#8FF2C8","#FFD67A","#FFB38A","#FFFFFF"];
      const pieces = [];
      const count = 160;

      for (let i=0;i<count;i++){
        pieces.push({
          x: window.innerWidth * 0.5,
          y: window.innerHeight * 0.46,
          vx: (Math.random()*2-1) * (4 + Math.random()*6),
          vy: (Math.random()*-1) * (10 + Math.random()*8),
          g: 0.22 + Math.random()*0.18,
          r: 3 + Math.random()*6,
          rot: Math.random()*Math.PI*2,
          vr: (Math.random()*2-1)*0.22,
          color: colors[Math.floor(Math.random()*colors.length)],
          shape: Math.random() < 0.5 ? "rect" : "circle",
        });
      }

      const start = performance.now();
      function frame(t){
        const elapsed = t - start;
        ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

        for (const p of pieces){
          p.vy += p.g;
          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.vr;

          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.fillStyle = p.color;

          if (p.shape === "rect"){
            ctx.fillRect(-p.r, -p.r, p.r*2.0, p.r*1.2);
          } else {
            ctx.beginPath();
            ctx.arc(0,0,p.r,0,Math.PI*2);
            ctx.fill();
          }
          ctx.restore();
        }

        if (elapsed < durationMs){
          requestAnimationFrame(frame);
        } else {
          ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
          confettiCanvas.classList.remove("show");
        }
      }
      requestAnimationFrame(frame);
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    /* SVG food art */
    function artSalt(){ return `
      <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="s1" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#E9F7FF"/><stop offset="1" stop-color="#BFE7FF"/>
        </linearGradient></defs>
        <rect x="36" y="20" width="48" height="14" rx="7" fill="#FFFFFF" stroke="#fff" stroke-width="4"/>
        <rect x="34" y="30" width="52" height="70" rx="16" fill="url(#s1)" stroke="#FFFFFF" stroke-width="6"/>
      </svg>`; }
    function artLemon(){ return `
      <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="l1" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#FFEFA8"/><stop offset="1" stop-color="#FFD67A"/>
        </linearGradient></defs>
        <ellipse cx="62" cy="62" rx="34" ry="26" fill="url(#l1)" stroke="#FFFFFF" stroke-width="6"/>
        <circle cx="42" cy="44" r="10" fill="#8FF2C8" stroke="#fff" stroke-width="6"/>
      </svg>`; }
    function artMilk(){ return `
      <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="m1" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#FFFFFF"/><stop offset="1" stop-color="#E9F7FF"/>
        </linearGradient></defs>
        <path d="M44 22 H76 L70 34 H50 Z" fill="#BFE7FF" stroke="#fff" stroke-width="6" />
        <rect x="42" y="32" width="36" height="72" rx="14" fill="url(#m1)" stroke="#fff" stroke-width="6"/>
      </svg>`; }
    function artHoney(){ return `
      <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="h1" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#FFEFA8"/><stop offset="1" stop-color="#FFB38A"/>
        </linearGradient></defs>
        <rect x="34" y="22" width="52" height="18" rx="9" fill="#FF99CD" stroke="#fff" stroke-width="6"/>
        <rect x="30" y="34" width="60" height="70" rx="18" fill="url(#h1)" stroke="#fff" stroke-width="6"/>
      </svg>`; }
    function artStrawberries(){ return `
      <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="st1" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#FFD1EB"/><stop offset="1" stop-color="#FF73B8"/>
        </linearGradient></defs>
        <path d="M26 54 C30 42, 90 42, 94 54 L88 96 C86 106, 34 106, 32 96 Z"
              fill="#E9F7FF" stroke="#fff" stroke-width="6"/>
        <circle cx="44" cy="70" r="14" fill="url(#st1)" stroke="#fff" stroke-width="6"/>
        <circle cx="66" cy="74" r="14" fill="url(#st1)" stroke="#fff" stroke-width="6"/>
        <circle cx="56" cy="88" r="14" fill="url(#st1)" stroke="#fff" stroke-width="6"/>
      </svg>`; }
    function artButter(){ return `
      <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="b1" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#FFEFA8"/><stop offset="1" stop-color="#FFD67A"/>
        </linearGradient></defs>
        <rect x="24" y="68" width="72" height="30" rx="14" fill="#E9F7FF" stroke="#fff" stroke-width="6"/>
        <rect x="34" y="38" width="62" height="34" rx="12" fill="url(#b1)" stroke="#fff" stroke-width="6"/>
      </svg>`; }

    renderIngredients();
    updateUI();
    resizeCanvas();
  </script>
</body>
</html>
